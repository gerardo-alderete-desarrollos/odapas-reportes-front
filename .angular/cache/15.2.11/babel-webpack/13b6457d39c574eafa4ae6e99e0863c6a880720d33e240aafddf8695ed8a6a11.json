{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { tap } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport class UsuarioService {\n  constructor(http, _router) {\n    this.http = http;\n    this._router = _router;\n    this.api = 'http://localhost:3000/usuarios';\n  }\n  // -----------------------------------------\n  // Registro\n  // -----------------------------------------\n  register(data) {\n    return this.http.post(`${this.api}/register`, data);\n  }\n  // -----------------------------------------\n  // Login\n  // -----------------------------------------\n  login(data) {\n    return this.http.post(`${this.api}/login`, data).pipe(tap(res => {\n      if (res.access_token) {\n        localStorage.setItem('token', res.access_token);\n        localStorage.setItem('usuario', JSON.stringify(res.usuario));\n        this._router.navigate(['/reportes']);\n      }\n    }));\n  }\n  // -----------------------------------------\n  // Obtener token\n  // -----------------------------------------\n  get token() {\n    return localStorage.getItem('token');\n  }\n  // -----------------------------------------\n  // Headers con Bearer Token\n  // -----------------------------------------\n  getAuthHeaders() {\n    return new HttpHeaders({\n      Authorization: `Bearer ${this.token}`\n    });\n  }\n  // -----------------------------------------\n  // Obtener usuario logueado (ruta protegida)\n  // -----------------------------------------\n  getPerfil() {\n    return this.http.get(`${this.api}/perfil`, {\n      headers: this.getAuthHeaders()\n    });\n  }\n  // -----------------------------------------\n  // Obtener todos los usuarios (puede ser protegido)\n  // -----------------------------------------\n  getUsuarios() {\n    return this.http.get(`${this.api}`, {\n      headers: this.getAuthHeaders()\n    });\n  }\n  // -----------------------------------------\n  // Cerrar sesión\n  // -----------------------------------------\n  logout() {\n    debugger;\n    localStorage.removeItem('token');\n    localStorage.removeItem('usuario');\n    this._router.navigate(['singin']);\n  }\n  static {\n    this.ɵfac = function UsuarioService_Factory(t) {\n      return new (t || UsuarioService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: UsuarioService,\n      factory: UsuarioService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"mappings":"AACA,SAAqBA,WAAW,QAAQ,sBAAsB;AAC9D,SAAqBC,GAAG,QAAQ,MAAM;;;;AAMtC,OAAM,MAAOC,cAAc;EAIzBC,YAAoBC,IAAgB,EAAUC,OAAe;IAAzC,SAAI,GAAJD,IAAI;IAAsB,YAAO,GAAPC,OAAO;IAF7C,QAAG,GAAG,gCAAgC;EAEkB;EAEhE;EACA;EACA;EACAC,QAAQ,CAACC,IAAS;IAChB,OAAO,IAAI,CAACH,IAAI,CAACI,IAAI,CAAC,GAAG,IAAI,CAACC,GAAG,WAAW,EAAEF,IAAI,CAAC;EACrD;EAEA;EACA;EACA;EACAG,KAAK,CAACH,IAAS;IACb,OAAO,IAAI,CAACH,IAAI,CAACI,IAAI,CAAC,GAAG,IAAI,CAACC,GAAG,QAAQ,EAAEF,IAAI,CAAC,CAACI,IAAI,CACnDV,GAAG,CAAEW,GAAQ,IAAI;MACf,IAAIA,GAAG,CAACC,YAAY,EAAE;QACpBC,YAAY,CAACC,OAAO,CAAC,OAAO,EAAEH,GAAG,CAACC,YAAY,CAAC;QAC/CC,YAAY,CAACC,OAAO,CAAC,SAAS,EAAEC,IAAI,CAACC,SAAS,CAACL,GAAG,CAACM,OAAO,CAAC,CAAC;QAC1D,IAAI,CAACb,OAAO,CAACc,QAAQ,CAAC,CAAC,WAAW,CAAC,CAAC;;IAE1C,CAAC,CAAC,CACH;EACH;EAEA;EACA;EACA;EACA,IAAIC,KAAK;IACP,OAAON,YAAY,CAACO,OAAO,CAAC,OAAO,CAAC;EACtC;EAEA;EACA;EACA;EACQC,cAAc;IACpB,OAAO,IAAItB,WAAW,CAAC;MACrBuB,aAAa,EAAE,UAAU,IAAI,CAACH,KAAK;KACpC,CAAC;EACJ;EAEA;EACA;EACA;EACAI,SAAS;IACP,OAAO,IAAI,CAACpB,IAAI,CAACqB,GAAG,CAAC,GAAG,IAAI,CAAChB,GAAG,SAAS,EAAE;MACzCiB,OAAO,EAAE,IAAI,CAACJ,cAAc;KAC7B,CAAC;EACJ;EAEA;EACA;EACA;EACAK,WAAW;IACT,OAAO,IAAI,CAACvB,IAAI,CAACqB,GAAG,CAAC,GAAG,IAAI,CAAChB,GAAG,EAAE,EAAE;MAClCiB,OAAO,EAAE,IAAI,CAACJ,cAAc;KAC7B,CAAC;EACJ;EAEA;EACA;EACA;EACAM,MAAM;IACJ;IACAd,YAAY,CAACe,UAAU,CAAC,OAAO,CAAC;IAChCf,YAAY,CAACe,UAAU,CAAC,SAAS,CAAC;IAClC,IAAI,CAACxB,OAAO,CAACc,QAAQ,CAAC,CAAC,QAAQ,CAAC,CAAC;EACnC;;;uBAtEWjB,cAAc;IAAA;EAAA;;;aAAdA,cAAc;MAAA4B,SAAd5B,cAAc;MAAA6B,YAFb;IAAM;EAAA","names":["HttpHeaders","tap","UsuarioService","constructor","http","_router","register","data","post","api","login","pipe","res","access_token","localStorage","setItem","JSON","stringify","usuario","navigate","token","getItem","getAuthHeaders","Authorization","getPerfil","get","headers","getUsuarios","logout","removeItem","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\Gerardo\\Documents\\Proyectos\\odapas\\odapas-reportes-front\\src\\app\\core\\shared\\services\\usuario.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { Observable, tap } from 'rxjs';\r\nimport { Router } from '@angular/router';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UsuarioService {\r\n\r\n  private api = 'http://localhost:3000/usuarios';\r\n\r\n  constructor(private http: HttpClient, private _router: Router) {}\r\n\r\n  // -----------------------------------------\r\n  // Registro\r\n  // -----------------------------------------\r\n  register(data: any): Observable<any> {\r\n    return this.http.post(`${this.api}/register`, data);\r\n  }\r\n\r\n  // -----------------------------------------\r\n  // Login\r\n  // -----------------------------------------\r\n  login(data: any): Observable<any> {\r\n    return this.http.post(`${this.api}/login`, data).pipe(\r\n      tap((res: any) => {\r\n        if (res.access_token) {\r\n          localStorage.setItem('token', res.access_token);\r\n          localStorage.setItem('usuario', JSON.stringify(res.usuario));\r\n            this._router.navigate(['/reportes'])\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  // -----------------------------------------\r\n  // Obtener token\r\n  // -----------------------------------------\r\n  get token(): string | null {\r\n    return localStorage.getItem('token');\r\n  }\r\n\r\n  // -----------------------------------------\r\n  // Headers con Bearer Token\r\n  // -----------------------------------------\r\n  private getAuthHeaders(): HttpHeaders {\r\n    return new HttpHeaders({\r\n      Authorization: `Bearer ${this.token}`\r\n    });\r\n  }\r\n\r\n  // -----------------------------------------\r\n  // Obtener usuario logueado (ruta protegida)\r\n  // -----------------------------------------\r\n  getPerfil(): Observable<any> {\r\n    return this.http.get(`${this.api}/perfil`, {\r\n      headers: this.getAuthHeaders()\r\n    });\r\n  }\r\n\r\n  // -----------------------------------------\r\n  // Obtener todos los usuarios (puede ser protegido)\r\n  // -----------------------------------------\r\n  getUsuarios(): Observable<any> {\r\n    return this.http.get(`${this.api}`, {\r\n      headers: this.getAuthHeaders()\r\n    });\r\n  }\r\n\r\n  // -----------------------------------------\r\n  // Cerrar sesión\r\n  // -----------------------------------------\r\n  logout() {\r\n    debugger\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('usuario');\r\n    this._router.navigate(['singin']);\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}