{"ast":null,"code":"import { HttpHeaders } from '@angular/common/http';\nimport { map, tap } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport class UsuarioService {\n  constructor(http, _router) {\n    this.http = http;\n    this._router = _router;\n    this.api = 'http://localhost:3000/usuarios';\n  }\n  // -----------------------------------------\n  // Registro\n  // -----------------------------------------\n  register(data) {\n    return this.http.post(`${this.api}/register`, data);\n  }\n  // -----------------------------------------\n  // Login\n  // -----------------------------------------\n  login(data) {\n    return this.http.post(`${this.api}/login`, data).pipe(tap(res => {\n      if (res.access_token) {\n        localStorage.setItem('token', res.access_token);\n        localStorage.setItem('usuario', JSON.stringify(res.usuario));\n        this._router.navigate(['/reportes']);\n      }\n    }));\n  }\n  // -----------------------------------------\n  // Obtener token\n  // -----------------------------------------\n  get token() {\n    return localStorage.getItem('token');\n  }\n  getToken() {\n    return localStorage.getItem('token');\n  }\n  // Obtener usuario logeado\n  getUsuario() {\n    const userString = localStorage.getItem('usuario');\n    if (!userString) return null;\n    try {\n      return JSON.parse(userString);\n    } catch {\n      return null;\n    }\n  }\n  // Saber si está logeado\n  isLoggedIn() {\n    return this.getToken() !== null;\n  }\n  // -----------------------------------------\n  // Headers con Bearer Token\n  // -----------------------------------------\n  getAuthHeaders() {\n    return new HttpHeaders({\n      Authorization: `Bearer ${this.token}`\n    });\n  }\n  // -----------------------------------------\n  // Obtener usuario logueado (ruta protegida)\n  // -----------------------------------------\n  getPerfil() {\n    return this.http.get(`${this.api}/perfil`, {\n      headers: this.getAuthHeaders()\n    });\n  }\n  // -----------------------------------------\n  // Obtener todos los usuarios (puede ser protegido)\n  // -----------------------------------------\n  getUsuarios() {\n    return this.http.get(`${this.api}`, {\n      headers: this.getAuthHeaders()\n    });\n  }\n  // -----------------------------------------\n  // Obtener todos los tecnicos por area\n  // -----------------------------------------\n  getTecnicos(area) {\n    return this.http.get(`${this.api}`, {\n      headers: this.getAuthHeaders()\n    }).pipe(map(usuarios => {\n      return usuarios.filter(u => u.rol === \"tecnico\" && u.area === area);\n    }));\n  }\n  // -----------------------------------------\n  // Cerrar sesión\n  // -----------------------------------------\n  logout() {\n    debugger;\n    localStorage.removeItem('token');\n    localStorage.removeItem('usuario');\n    this._router.navigate(['singin']);\n  }\n  static {\n    this.ɵfac = function UsuarioService_Factory(t) {\n      return new (t || UsuarioService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.Router));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: UsuarioService,\n      factory: UsuarioService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"mappings":"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","names":["HttpHeaders","map","tap","UsuarioService","constructor","http","_router","register","data","post","api","login","pipe","res","access_token","localStorage","setItem","JSON","stringify","usuario","navigate","token","getItem","getToken","getUsuario","userString","parse","isLoggedIn","getAuthHeaders","Authorization","getPerfil","get","headers","getUsuarios","getTecnicos","area","usuarios","filter","u","rol","logout","removeItem","factory","providedIn"],"sourceRoot":"","sources":["C:\\Users\\Gerardo\\Documents\\Proyectos\\odapas\\odapas-reportes-front\\src\\app\\core\\shared\\services\\usuario.service.ts"],"sourcesContent":["import { Injectable } from '@angular/core';\r\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\r\nimport { map, Observable, tap } from 'rxjs';\r\nimport { Router } from '@angular/router';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\nexport class UsuarioService {\r\n\r\n  private api = 'http://localhost:3000/usuarios';\r\n\r\n  constructor(private http: HttpClient, private _router: Router) {}\r\n\r\n  // -----------------------------------------\r\n  // Registro\r\n  // -----------------------------------------\r\n  register(data: any): Observable<any> {\r\n    return this.http.post(`${this.api}/register`, data);\r\n  }\r\n\r\n  // -----------------------------------------\r\n  // Login\r\n  // -----------------------------------------\r\n  login(data: any): Observable<any> {\r\n    return this.http.post(`${this.api}/login`, data).pipe(\r\n      tap((res: any) => {\r\n        if (res.access_token) {\r\n          localStorage.setItem('token', res.access_token);\r\n          localStorage.setItem('usuario', JSON.stringify(res.usuario));\r\n            this._router.navigate(['/reportes'])\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  // -----------------------------------------\r\n  // Obtener token\r\n  // -----------------------------------------\r\n  get token(): string | null {\r\n    return localStorage.getItem('token');\r\n  }\r\n\r\n  getToken(): string | null {\r\n    return localStorage.getItem('token');\r\n  }\r\n\r\n  // Obtener usuario logeado\r\n  getUsuario(): any {\r\n    const userString = localStorage.getItem('usuario');\r\n    if (!userString) return null;\r\n\r\n    try {\r\n      return JSON.parse(userString);\r\n    } catch {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  // Saber si está logeado\r\n  isLoggedIn(): boolean {\r\n    return this.getToken() !== null;\r\n  }\r\n\r\n  // -----------------------------------------\r\n  // Headers con Bearer Token\r\n  // -----------------------------------------\r\n  private getAuthHeaders(): HttpHeaders {\r\n    return new HttpHeaders({\r\n      Authorization: `Bearer ${this.token}`\r\n    });\r\n  }\r\n\r\n  // -----------------------------------------\r\n  // Obtener usuario logueado (ruta protegida)\r\n  // -----------------------------------------\r\n  getPerfil(): Observable<any> {\r\n    return this.http.get(`${this.api}/perfil`, {\r\n      headers: this.getAuthHeaders()\r\n    });\r\n  }\r\n\r\n  // -----------------------------------------\r\n  // Obtener todos los usuarios (puede ser protegido)\r\n  // -----------------------------------------\r\n  getUsuarios(): Observable<any> {\r\n    return this.http.get(`${this.api}`, {\r\n      headers: this.getAuthHeaders()\r\n    });\r\n  }\r\n  // -----------------------------------------\r\n  // Obtener todos los tecnicos por area\r\n  // -----------------------------------------\r\n  getTecnicos(area?: string): Observable<any> {\r\n    return this.http.get<any[]>(`${this.api}`, {\r\n      headers: this.getAuthHeaders()\r\n    }).pipe(\r\n      map((usuarios)=> {\r\n        return usuarios.filter( u => u.rol === \"tecnico\" && u.area === area);\r\n      })\r\n    )\r\n  }\r\n\r\n  // -----------------------------------------\r\n  // Cerrar sesión\r\n  // -----------------------------------------\r\n  logout() {\r\n    debugger\r\n    localStorage.removeItem('token');\r\n    localStorage.removeItem('usuario');\r\n    this._router.navigate(['singin']);\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}